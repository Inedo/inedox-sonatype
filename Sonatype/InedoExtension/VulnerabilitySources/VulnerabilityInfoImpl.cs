using Inedo.Extensibility.VulnerabilitySources;
using Inedo.Feeds;

namespace Inedo.Extensions.Sonatype.VulnerabilitySources
{
    internal sealed class VulnerabilityInfoImpl : VulnerabilityInfo
    {
        private static string[] cvssScoreRange = new[]
        {
            "low", // 0
            "low", // 1
            "low", // 2
            "low", // 3
            "medium", // 4
            "medium", // 5
            "medium", // 6
            "high", // 7
            "high", // 8
            "critical", // 9
            "critical", // 10
        };

        public VulnerabilityInfoImpl(Vulnerability vulnerability, PackageCoordinate package)
        {
            this.Id = vulnerability.Id;
            this.FeedType = package.Package.FeedType;
            this.PackageName = package.Package.Name;
            this.PackageVersions = PackageCoordinate.DecodeVersonRange(vulnerability.AffectedVersions);
            this.Title = vulnerability.Title;
            this.Description = $"{vulnerability.Description}\n\nSeverity: {vulnerability.CVSSScore:##.0} ({cvssScoreRange[(int)vulnerability.CVSSScore]})\nMore information: {vulnerability.Reference}";
        }

        public override string Id { get; }
        public override FeedType FeedType { get; }
        public override string PackageName { get; }
        public override VulnerabilityPackageVersionRange PackageVersions { get; }
        public override string Title { get; }
        public override string Description { get; }
    }
}
